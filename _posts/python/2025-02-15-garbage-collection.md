---
title: "Python Garbage Collection (ê°€ë¹„ì§€ ì»¬ë ‰ì…˜)"
date: 2025-02-15
categories: [python]
tags: [python, garbage-collection, memory]
---

## ê°œìš”

ì–¼ë§ˆ ì „ íšŒì‚¬ì—ì„œ ì´ìƒí•œ í˜„ìƒì„ ê²ªì—ˆë‹¤. Python ìŠ¤í¬ë¦½íŠ¸ê°€ ëë‚¬ëŠ”ë°ë„ ë©”ëª¨ë¦¬ê°€ í•´ì œë˜ì§€ ì•ŠëŠ” ê²ƒì´ì—ˆë‹¤.

```python
def process_data():
    big_list = [i for i in range(1000000)]  # ì•½ 40MB ë©”ëª¨ë¦¬ ì‚¬ìš©
    # ì—¬ê¸°ì„œ ë­”ê°€ ì²˜ë¦¬...
    return "ì™„ë£Œ"

result = process_data()
print("í•¨ìˆ˜ ëë‚¬ëŠ”ë° ë©”ëª¨ë¦¬ê°€ ì™œ ì•ˆ ì¤„ì–´ë“¤ì§€?")
```

ë¶„ëª…íˆ í•¨ìˆ˜ê°€ ëë‚¬ìœ¼ë‹ˆê¹Œ `big_list`ëŠ” ì‚¬ë¼ì ¸ì•¼ í•˜ëŠ”ë°, ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë¥¼ ë³´ë©´ ì—¬ì „íˆ 40MBë¥¼ ì°¨ì§€í•˜ê³  ìˆì—ˆë‹¤.

> "Pythonì´ ìë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬í•´ì¤€ë‹¤ë©´ì„œ ì™œ ì´ëŸ° ì¼ì´?"

ê·¸ë˜ì„œ Python ê°€ë¹„ì§€ ì»¬ë ‰í„°(Garbage Collector)ì— ëŒ€í•´ ì œëŒ€ë¡œ ì•Œì•„ë³´ë ¤í•œë‹¤.

---

## Python ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ë³¸ ì›ë¦¬

### ğŸ“Œ ì°¸ì¡° ì¹´ìš´íŒ… (Reference Counting)

Pythonì˜ ê¸°ë³¸ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë°©ì‹ì€ **ì°¸ì¡° ì¹´ìš´íŒ…**ì´ë‹¤.

```python
# ì°¸ì¡° ì¹´ìš´íŒ… ì˜ˆì‹œ
import sys

data = [1, 2, 3, 4, 5]
print(f"ì°¸ì¡° ì¹´ìš´íŠ¸: {sys.getrefcount(data)}")  # 2 (data ë³€ìˆ˜ + getrefcount í•¨ìˆ˜)

backup = data  # ì°¸ì¡° ì¹´ìš´íŠ¸ ì¦ê°€
print(f"ì°¸ì¡° ì¹´ìš´íŠ¸: {sys.getrefcount(data)}")  # 3

del backup     # ì°¸ì¡° ì¹´ìš´íŠ¸ ê°ì†Œ
print(f"ì°¸ì¡° ì¹´ìš´íŠ¸: {sys.getrefcount(data)}")  # 2

del data       # ì°¸ì¡° ì¹´ìš´íŠ¸ 0 â†’ ì¦‰ì‹œ ë©”ëª¨ë¦¬ í•´ì œ
```

**ì°¸ì¡° ì¹´ìš´íŒ…ì˜ ë™ì‘:**
- ê°ì²´ë¥¼ ì°¸ì¡°í•  ë•Œë§ˆë‹¤ ì¹´ìš´íŠ¸ +1
- ì°¸ì¡°ê°€ ì‚¬ë¼ì§ˆ ë•Œë§ˆë‹¤ ì¹´ìš´íŠ¸ -1  
- ì¹´ìš´íŠ¸ê°€ 0ì´ ë˜ë©´ **ì¦‰ì‹œ ë©”ëª¨ë¦¬ í•´ì œ**

### ğŸ¤” ê·¸ëŸ°ë° ì™œ ë©”ëª¨ë¦¬ê°€ ì•ˆ í•´ì œë ê¹Œ?

ì°¸ì¡° ì¹´ìš´íŒ…ë§Œìœ¼ë¡œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ê°€ ìˆë‹¤. **ìˆœí™˜ ì°¸ì¡°**ë‹¤.

```python
class Node:
    def __init__(self, value):
        self.value = value
        self.children = []
        self.parent = None

# ìˆœí™˜ ì°¸ì¡° ìƒí™© ë§Œë“¤ê¸°
parent = Node("ë¶€ëª¨")
child = Node("ìì‹")

parent.children.append(child)  # ë¶€ëª¨ â†’ ìì‹ ì°¸ì¡°
child.parent = parent          # ìì‹ â†’ ë¶€ëª¨ ì°¸ì¡°

# ì´ì œ ë‘˜ ë‹¤ ì‚­ì œí•´ë³´ì
del parent
del child

# ê·¸ëŸ°ë° ë©”ëª¨ë¦¬ê°€ í•´ì œë ê¹Œ?
# ë‹µ: ì•ˆ ëœë‹¤! ì„œë¡œë¥¼ ì°¸ì¡°í•˜ê³  ìˆì–´ì„œ ì°¸ì¡° ì¹´ìš´íŠ¸ê°€ 0ì´ ì•ˆ ë¨
```

**ìˆœí™˜ ì°¸ì¡° ë¬¸ì œ:**
- `parent`ëŠ” `child`ë¥¼ ì°¸ì¡°
- `child`ëŠ” `parent`ë¥¼ ì°¸ì¡°  
- ë³€ìˆ˜ë¥¼ ì‚­ì œí•´ë„ ì„œë¡œì˜ ì°¸ì¡° ì¹´ìš´íŠ¸ëŠ” 1ë¡œ ìœ ì§€
- ê²°ê³¼ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ

---

## Python ê°€ë¹„ì§€ ì»¬ë ‰í„°ì˜ ì—­í• 

### ğŸ—‘ï¸ ìˆœí™˜ ì°¸ì¡° ê°ì§€ì™€ í•´ì œ

Pythonì€ ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **ê°€ë¹„ì§€ ì»¬ë ‰í„°**ë¥¼ ì‚¬ìš©í•œë‹¤.

```python
import gc

# ê°€ë¹„ì§€ ì»¬ë ‰í„° ìƒíƒœ í™•ì¸
print(f"ê°€ë¹„ì§€ ì»¬ë ‰í„° í™œì„±í™”: {gc.isenabled()}")
print(f"í˜„ì¬ ê°ì²´ ìˆ˜: {len(gc.get_objects())}")

# ìˆœí™˜ ì°¸ì¡° ê°ì²´ ìƒì„±
def create_circular_reference():
    parent = Node("ë¶€ëª¨")
    child = Node("ìì‹")
    parent.children.append(child)
    child.parent = parent
    return "ìˆœí™˜ ì°¸ì¡° ìƒì„± ì™„ë£Œ"

result = create_circular_reference()
print(f"ìƒì„± í›„ ê°ì²´ ìˆ˜: {len(gc.get_objects())}")

# ìˆ˜ë™ìœ¼ë¡œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹¤í–‰
collected = gc.collect()
print(f"ìˆ˜ì§‘ëœ ê°ì²´ ìˆ˜: {collected}")
print(f"ìˆ˜ì§‘ í›„ ê°ì²´ ìˆ˜: {len(gc.get_objects())}")
```

### ğŸ“Š ì„¸ëŒ€ë³„ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜

Pythonì€ **ì„¸ëŒ€ë³„(Generational) ê°€ë¹„ì§€ ì»¬ë ‰ì…˜**ì„ ì‚¬ìš©í•œë‹¤.

```python
# ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ í†µê³„ í™•ì¸
print(gc.get_stats())

# ìƒˆë¡œ ìƒì„±ëœ ê°ì²´ë“¤ (ì„¸ëŒ€ 0)
temp1 = [1, 2, 3]      # í•¨ìˆ˜ ì•ˆì—ì„œ ì ê¹ ì“°ê³  ë²„ë¦´ ê°ì²´
temp2 = "hello"        # ì„ì‹œ ë¬¸ìì—´
temp3 = {"key": "val"} # ì„ì‹œ ë”•ì…”ë„ˆë¦¬

# ì‹œê°„ì´ ì§€ë‚˜ë„ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ (ì„¸ëŒ€ 1)
class_instance = MyClass()  # í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤
global_config = {...}      # ì „ì—­ ì„¤ì •

# í”„ë¡œê·¸ë¨ ë‚´ë‚´ ì“°ì´ëŠ” ê°ì²´ë“¤ (ì„¸ëŒ€ 2)  
imported_modules = sys.modules  # ì„í¬íŠ¸ëœ ëª¨ë“ˆë“¤

# ì¶œë ¥ ì˜ˆì‹œ:
# [{'collections': 123, 'collected': 45, 'uncollectable': 0},    # ì„¸ëŒ€ 0
#  {'collections': 11,  'collected': 12, 'uncollectable': 0},    # ì„¸ëŒ€ 1  
#  {'collections': 1,   'collected': 3,  'uncollectable': 0}]    # ì„¸ëŒ€ 2
```

**ì„¸ëŒ€ë³„ ë¶„ë¥˜ ì›ë¦¬:**
- **ì„¸ëŒ€ 0**: ìƒˆë¡œ ìƒì„±ëœ ê°ì²´ë“¤ (ìì£¼ ê²€ì‚¬)
- **ì„¸ëŒ€ 1**: ì„¸ëŒ€ 0ì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ (ê°€ë” ê²€ì‚¬)
- **ì„¸ëŒ€ 2**: ì„¸ëŒ€ 1ì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ (ë“œë¬¼ê²Œ ê²€ì‚¬)

**ì™œ ì´ë ‡ê²Œ í• ê¹Œ?**
- ìƒˆë¡œìš´ ê°ì²´ë“¤ì€ ê¸ˆë°© ì‚¬ìš©ë˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒ
- ì˜¤ë˜ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì€ ê³„ì† ì“°ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ
- ë”°ë¼ì„œ ìƒˆ ê°ì²´ë“¤ì„ ë” ìì£¼ ê²€ì‚¬í•˜ëŠ” ê²Œ íš¨ìœ¨ì 

### ğŸ”§ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì„ê³„ê°’

```python
# í˜„ì¬ ì„ê³„ê°’ í™•ì¸
print(f"ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì„ê³„ê°’: {gc.get_threshold()}")
# ì¶œë ¥: (700, 10, 10)

# ì˜ë¯¸:
# - ì„¸ëŒ€ 0: ìƒˆ ê°ì²´ 700ê°œ ìƒì„±ë˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹¤í–‰
# - ì„¸ëŒ€ 1: ì„¸ëŒ€ 0ì—ì„œ 10ë²ˆ ì»¬ë ‰ì…˜ì´ ì¼ì–´ë‚˜ë©´ ì‹¤í–‰
# - ì„¸ëŒ€ 2: ì„¸ëŒ€ 1ì—ì„œ 10ë²ˆ ì»¬ë ‰ì…˜ì´ ì¼ì–´ë‚˜ë©´ ì‹¤í–‰
```

---

## ì‹¤ì œ ë¬¸ì œ ìƒí™©ê³¼ í•´ê²°ë²•

### ğŸš¨ ë¬¸ì œ ìƒí™© : í° ê°ì²´ê°€ í•´ì œë˜ì§€ ì•ŠëŠ” ê²½ìš°

```python
import gc
from memory_profiler import profile

@profile
def memory_leak_example():
    # í° ë°ì´í„° êµ¬ì¡° ìƒì„±
    big_data = {}
    for i in range(100000):
        big_data[i] = {
            'data': [j for j in range(100)],
            'reference': big_data  # ìê¸° ìì‹ ì„ ì°¸ì¡°!
        }
    
    print("ë°ì´í„° ìƒì„± ì™„ë£Œ")
    # í•¨ìˆ˜ê°€ ëë‚˜ë„ ìˆœí™˜ ì°¸ì¡° ë•Œë¬¸ì— ë©”ëª¨ë¦¬ í•´ì œ ì•ˆë¨
    return "ì™„ë£Œ"

# ì‹¤í–‰ ì „ ë©”ëª¨ë¦¬ í™•ì¸
print(f"ì‹¤í–‰ ì „ ê°ì²´ ìˆ˜: {len(gc.get_objects())}")

result = memory_leak_example()

print(f"ì‹¤í–‰ í›„ ê°ì²´ ìˆ˜: {len(gc.get_objects())}")

# ìˆ˜ë™ìœ¼ë¡œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹¤í–‰
collected = gc.collect()
print(f"ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ìœ¼ë¡œ ìˆ˜ì§‘ëœ ê°ì²´: {collected}")
print(f"ìˆ˜ì§‘ í›„ ê°ì²´ ìˆ˜: {len(gc.get_objects())}")
```

### âœ… í•´ê²°ë²• 1: ëª…ì‹œì  ì°¸ì¡° í•´ì œ

```python
def memory_safe_example():
    big_data = {}
    for i in range(100000):
        big_data[i] = {
            'data': [j for j in range(100)],
            # ìˆœí™˜ ì°¸ì¡° ì œê±°
        }
    
    # ëª…ì‹œì ìœ¼ë¡œ ì°¸ì¡° í•´ì œ
    del big_data
    
    # í•„ìš”í•˜ë©´ ìˆ˜ë™ìœ¼ë¡œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹¤í–‰
    gc.collect()
    
    return "ì™„ë£Œ"
```

### âœ… í•´ê²°ë²• 2: weakref ì‚¬ìš©

```python
import weakref

class SafeNode:
    def __init__(self, value):
        self.value = value
        self.children = []
        self._parent = None  # ì•½í•œ ì°¸ì¡°ë¡œ ì €ì¥
    
    @property
    def parent(self):
        return self._parent() if self._parent else None
    
    @parent.setter  
    def parent(self, value):
        self._parent = weakref.ref(value) if value else None

# ì‚¬ìš©ë²•
parent = SafeNode("ë¶€ëª¨")
child = SafeNode("ìì‹")

parent.children.append(child)
child.parent = parent  # ì•½í•œ ì°¸ì¡°ë¡œ ì €ì¥

# ì´ì œ ë¶€ëª¨ë¥¼ ì‚­ì œí•˜ë©´ ì œëŒ€ë¡œ í•´ì œë¨
del parent
print(f"ìì‹ì˜ ë¶€ëª¨: {child.parent}")  # None
```

---

## ì‹¤ë¬´ì—ì„œ í™œìš©í•  ìˆ˜ ìˆëŠ” íŒë“¤

### ğŸ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë””ë²„ê¹…í•˜ê¸°

```python
import gc
import objgraph

def debug_memory_leak():
    # íƒ€ì…ë³„ ê°ì²´ ìˆ˜ í™•ì¸
    objgraph.show_most_common_types(limit=10)
    
    # íŠ¹ì • íƒ€ì…ì˜ ì°¸ì¡° ê´€ê³„ í™•ì¸
    objgraph.show_backrefs([gc.get_objects()[0]], filename='refs.png')
    
    # ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ìœ¼ë¡œ ìˆ˜ì§‘í•  ìˆ˜ ì—†ëŠ” ê°ì²´ë“¤ í™•ì¸
    if gc.garbage:
        print("ìˆ˜ì§‘ ë¶ˆê°€ëŠ¥í•œ ê°ì²´ë“¤:")
        for obj in gc.garbage:
            print(type(obj), obj)

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
def monitor_memory_usage():
    import tracemalloc
    
    tracemalloc.start()
    
    # ì—¬ê¸°ì„œ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì½”ë“œ ì‹¤í–‰
    suspicious_function()
    
    # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¶„ì„
    current, peak = tracemalloc.get_traced_memory()
    print(f"í˜„ì¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: {current / 1024 / 1024:.1f} MB")
    print(f"ìµœëŒ€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: {peak / 1024 / 1024:.1f} MB")
    
    tracemalloc.stop()
```

---

## ê²°ë¡ 

### ğŸ“ í•µì‹¬ í¬ì¸íŠ¸ë“¤

1. **Pythonì€ ì°¸ì¡° ì¹´ìš´íŒ… + ê°€ë¹„ì§€ ì»¬ë ‰ì…˜**ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬
2. **ìˆœí™˜ ì°¸ì¡°**ëŠ” ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ í•´ê²°í•˜ì§€ë§Œ ì¦‰ì‹œëŠ” ì•„ë‹˜
3. **ì„¸ëŒ€ë³„ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜**ìœ¼ë¡œ íš¨ìœ¨ì„± í™•ë³´
4. **í•„ìš”ì‹œ ìˆ˜ë™ ì¡°ì •**ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™” ê°€ëŠ¥

### ğŸ¯ ì‹¤ë¬´ì—ì„œ ê¸°ì–µí•  ê²ƒë“¤

**ì–¸ì œ ì‹ ê²½ ì¨ì•¼ í•˜ë‚˜:**
- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬í•  ë•Œ
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ê³„ì† ì¦ê°€í•  ë•Œ  
- ì„±ëŠ¥ì´ ì ì§„ì ìœ¼ë¡œ ëŠë ¤ì§ˆ ë•Œ
- ìˆœí™˜ ì°¸ì¡°ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ë§Œë“¤ ë•Œ

**ê°„ë‹¨í•œ í•´ê²°ì±…:**
```python
# 1. ëª…ì‹œì  ì‚­ì œ
del big_object
gc.collect()

# 2. ì•½í•œ ì°¸ì¡° ì‚¬ìš©
import weakref
weak_ref = weakref.ref(object)
```
---
